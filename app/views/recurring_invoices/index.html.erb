<% content_for :page_title, "Recurring Line Items" %>
<div class="container py-2 py-md-5">

  <div class="card">
    <div class="card-body p-3">
      
      <!-- Tabs -->
      <ul class="nav nav-tabs" id="recurringTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="active-tab" data-bs-toggle="tab" data-bs-target="#active" type="button" role="tab">
            Active
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="disabled-tab" data-bs-toggle="tab" data-bs-target="#disabled" type="button" role="tab">
            Disabled
          </button>
        </li>
      </ul>

      <!-- Tab Content -->
      <div class="tab-content mt-3" id="recurringTabsContent">

        <!-- Active Recurring Table -->
        <div class="tab-pane fade show active" id="active" role="tabpanel" aria-labelledby="active-tab">
          <table id="recurring-items-table" class="table table-hover table-striped table-bordered align-middle nowrap w-100">
            <thead>
              <tr>
                <th>Invoice #</th>
                <th>Description</th>
                <th>Qty</th>
                <th>Unit</th>
                <th>Price</th>
                <th>Total</th>
                <th>Every (day)</th>
                <th>Interval</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% @recurring_items.each do |item| %>
                <tr>
                    <td><%= item[:invoice_number] %></td>
                    <td><%= item[:description] %></td>
                    <td><%= item[:quantity] %></td>
                    <td><%= item[:unit] %></td>
                    <td><%= item[:price] %></td>
                    <td><%= item[:total] %></td>
                    <td><%= item[:every] %></td>
                    <td><%= item[:interval] %></td>
                    <td><%= item[:start_date] %></td>
                    <td><%= item[:end_date] %></td>
                    <td class="text-center">
                        <div class="dropdown">
                            <button class="btn btn-link text-dark p-0 fs-3 text-decoration-none"
                                    type="button"
                                    id="actionsDropdown_<%= item[:invoice_id] %>_<%= item[:line_index] %>"
                                    data-bs-toggle="dropdown"
                                    aria-expanded="false">
                            &#8942;
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="actionsDropdown_<%= item[:invoice_id] %>_<%= item[:line_index] %>">
                            
                            <!-- Edit (open jQuery modal) -->
                            <li>
                                <a href="#" class="dropdown-item edit-btn"
                                    data-invoice-id="<%= item[:invoice_id] %>"
                                    data-line-index="<%= item[:line_index] %>"
                                    data-mode="yes"
                                    data-interval="<%= item[:interval] %>"
                                    data-every="<%= item[:every] %>"
                                    data-start-date="<%= item[:start_date] %>"
                                    data-end-date="<%= item[:end_date] %>"
                                    data-count="<%= item[:count] %>">
                                    Edit
                                </a>
                            </li>

                            <!-- Disable -->
                            <li>
                                <a href="#" class="dropdown-item disable-btn"
                                data-invoice-id="<%= item[:invoice_id] %>"
                                data-line-index="<%= item[:line_index] %>">
                                Disable
                                </a>
                            </li>

                            <!-- Delete -->
                            <li>
                                <a href="#" class="dropdown-item text-danger delete-btn"
                                data-invoice-id="<%= item[:invoice_id] %>"
                                data-line-index="<%= item[:line_index] %>">
                                Delete
                                </a>
                            </li>
                            </ul>
                        </div>
                    </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>

        <!-- Disabled Recurring Table -->
        <div class="tab-pane fade" id="disabled" role="tabpanel" aria-labelledby="disabled-tab">
          <table id="disabled-recurring-items-table" class="table table-hover table-striped table-bordered align-middle nowrap w-100">
            <thead>
              <tr>
                <th>Invoice #</th>
                <th>Description</th>
                <th>Qty</th>
                <th>Unit</th>
                <th>Price</th>
                <th>Total</th>
                <th>Every (day)</th>
                <th>Interval</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% @disabled_recurring_items.each do |item| %>
                <tr>
                  <td><%= item[:invoice_number] %></td>
                  <td><%= item[:description] %></td>
                  <td><%= item[:quantity] %></td>
                  <td><%= item[:unit] %></td>
                  <td><%= item[:price] %></td>
                  <td><%= item[:total] %></td>
                  <td><%= item[:every] %></td>
                  <td><%= item[:interval] %></td>
                  <td><%= item[:start_date] %></td>
                  <td><%= item[:end_date] %></td>
                  <td class="text-center">
                    <div class="dropdown">
                      <button class="btn btn-link text-dark p-0 fs-3 text-decoration-none"
                              type="button" data-bs-toggle="dropdown">
                        &#8942;
                      </button>
                      <ul class="dropdown-menu">
                        <!-- Enable -->
                        <li>
                          <a href="#" class="dropdown-item enable-btn"
                             data-invoice-id="<%= item[:invoice_id] %>"
                             data-line-index="<%= item[:line_index] %>">
                            Enable
                          </a>
                        </li>
                        <!-- Delete -->
                        <li>
                          <a href="#" class="dropdown-item text-danger delete-btn"
                             data-invoice-id="<%= item[:invoice_id] %>"
                             data-line-index="<%= item[:line_index] %>">
                            Delete
                          </a>
                        </li>
                      </ul>
                    </div>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>

      </div>
    </div>
  </div>

    <!-- Edit Recurring Item Modal -->
    <div class="modal fade" id="editRecurringModal" tabindex="-1" aria-labelledby="editRecurringModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editRecurringModalLabel">Edit Recurring Item</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editRecurringForm">
                        <input type="hidden" name="invoice_id" id="invoice_id">
                        <input type="hidden" name="line_index" id="line_index">

                        <div class="mb-2">
                            <label>Recurring</label>
                            <select name="mode" id="mode" class="form-select">
                            <option value="yes">Yes</option>
                            <option value="no">No</option>
                            </select>
                        </div>

                        <div class="mb-2">
                            <label>Interval</label>
                            <select name="interval" id="interval" class="form-select">
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                            <option value="yearly">Yearly</option>
                            </select>
                        </div>

                        <div class="mb-2">
                            <label>Every (day)</label>
                            <input type="number" name="every" id="every" class="form-control">
                        </div>

                        <div class="mb-2">
                            <label>Start Date</label>
                            <input type="date" name="start_date" id="start_date" class="form-control">
                        </div>

                        <div class="mb-2">
                            <label>End Date</label>
                            <input type="date" name="end_date" id="end_date" class="form-control">
                        </div>

                        <button type="submit" class="btn btn-primary">Save</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
